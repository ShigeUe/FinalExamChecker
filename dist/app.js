(()=>{"use strict";class e{static ROOT;static ROOT_BODY;static DEBUGGEE;static ATTACHED=!1;static PROCESSING=!1;static RESULTS;static RESULT_MESSAGES;static CHECK_ELEMENTS_PROPERTIES_MESSAGE;static POSITION_RELATIVE_CHECK;static MODEL_DATA;static METRICS}const t={element:document.getElementById("messages"),add:function(e,t){const n=document.createElement("div");if(e?"html"==t?n.innerHTML=e:n.innerText=e:n.innerHTML="&nbsp;",("error"==t||"info"==t||"title"==t||"emphasis"==t||"notice"==t)&&(n.classList.add(t),"title"==t)){const t="ID"+function(e){const t=(new TextEncoder).encode(e);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,8)}(e);n.id=t,n.addEventListener("click",()=>window.scrollTo(0,0))}this.element.append(n),window.scrollTo(0,document.body.scrollHeight)},addHighlightNodeText:function(t,n){const o=document.createElement("div");o.addEventListener("mouseenter",async()=>{e.PROCESSING||(await m("DOM.scrollIntoViewIfNeeded",{nodeId:n}),await m("Overlay.highlightNode",{highlightConfig:HIGHLIGHTCONFIG,nodeId:n}))}),o.addEventListener("mouseleave",async()=>{e.PROCESSING||await m("Overlay.hideHighlight")}),o.innerHTML=t,o.classList.add("position-relative"),this.element.append(o),window.scrollTo(0,document.body.scrollHeight)},table:function(t,n,o,i){const a=document.createElement("div");a.classList.add("table");const r=document.createElement("div");r.classList.add("head");const s=document.createElement("div");s.classList.add("body");const c=document.createElement("div");c.classList.add("row");const d=document.createElement("div");d.classList.add("row"),d.classList.add("model");const l=document.createElement("div");l.classList.add("row");for(let e=0;e<n.length;e++){const a=document.createElement("div");a.classList.add("col"),a.innerText=t[e]??"",c.append(a);const r=document.createElement("div");if(r.classList.add("col"),r.innerText=n[e],d.append(r),""!=o[e]){const t=document.createElement("div");t.classList.add("col"),t.setAttribute("contenteditable",""),i.indexOf(e+1)>=0&&t.classList.add("em"),o[e].indexOf("要素が取得できません")>=0&&(t.style.width="100%"),t.innerText=o[e],l.append(t)}}r.append(c),s.append(d),s.append(l),a.append(r,s),a.addEventListener("mouseenter",async function(t){const n=this.querySelector(".head .row .col:first-child"),o=n.innerText.match(/\d+/)?.at(0)-0;o&&!e.PROCESSING&&(await m("DOM.scrollIntoViewIfNeeded",{nodeId:o}),await m("Overlay.highlightNode",{highlightConfig:HIGHLIGHTCONFIG,nodeId:o}))}),a.addEventListener("mouseleave",async function(t){e.PROCESSING||await m("Overlay.hideHighlight")}),this.element.append(a),window.scrollTo(0,document.body.scrollHeight)},reset:function(){this.element.innerHTML=""},emptyLine:function(){this.add(null)},makeToc:function(){const e=document.createElement("ul");e.classList.add("toc"),this.element.querySelectorAll(".title").forEach(t=>{const n=document.createElement("li"),o=document.createElement("a");o.href="#"+t.id,o.innerText=t.innerText,n.append(o),e.append(n)}),this.element.prepend(e)}};function n(e,t){return e.find(e=>e.name==t)}function o(t,n){if(n||(n=e.ROOT_BODY),n.children)for(const e of n.children){if(e.nodeId==t)return e;{const n=o(t,e);if(n)return n}}return null}function i(e){return e.replaceAll('"',"").split(",").at(0).trim()}function a(e){return new Promise(t=>{setTimeout(t,e)},()=>{})}function r(e){const t=e.match(/\d+/g);return 3!==t.length?"#000000":"#"+t.map(e=>("0"+Number(e).toString(16)).slice(-2)).join("")}function s(e,t){const[n,o,i,a]=e,[r,s,c,d]=t,l=Math.max(n,r),u=Math.max(o,s),m=Math.min(i,c)-l,p=Math.min(a,d)-u;return m>0&&p>0?m*p:0}function c(e){return new Promise(t=>{chrome.devtools.inspectedWindow.eval(e,e=>t(e))})}async function d(e){const n=new RegExp("\\/"+e);return new Promise(o=>{chrome.devtools.inspectedWindow.getResources(i=>{const a=i.find(e=>e.url.match(n));a||(t.add(`${e}が読み込まれていません。`,"error"),o("")),a.getContent(n=>{if(!n)return t.add(`${e}が取得できませんでした。`,"error"),void o("");o(n)})})})}async function l(e,t){const n=await m("DOM.getNodeForLocation",{x:e,y:t});return n?n.nodeId:null}function u(n,o,i){let a=`コード：${o}，カンプ：${i}`;t.add(n+`の差異（${a}）`),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE+=`${n}の差異<span class="red">（${a}）</span><br>`}async function m(t,n){if(!e.ATTACHED)return;let o=null;try{o=void 0===n?await chrome.debugger.sendCommand(e.DEBUGGEE,t):await chrome.debugger.sendCommand(e.DEBUGGEE,t,n)}catch(e){console.log(e)}return o}function p(e){const t=e.split(".");return 100*Number(t[0])+Number(t[1])}async function E(e,t){const n=t.find(e=>"background-color"===e.type||e.type.match(/^border-.*-width$/));if(!n)return e;let i=e;for(let t=0;t<4;t++){let t;try{t=(await m("CSS.getComputedStyleForNode",{nodeId:i})).computedStyle}catch(t){return e}const a=t.find(e=>e.name===n.type);if("background-color"===a.name&&"rgba(0, 0, 0, 0)"!==a.value||a.name.match(/^border-.*-width$/)&&"0px"!==a.value)return i;if(!o(i).parentId)return e;i=o(i).parentId}return e}document.getElementById("detach").addEventListener("click",async n=>{n.preventDefault(),await chrome.debugger.detach(e.DEBUGGEE),t.reset()}),document.getElementById("notice-close").addEventListener("click",e=>{e.preventDefault(),document.querySelector("header .notice").style.display="none"}),document.getElementById("checker").addEventListener("click",async p=>{if(p.preventDefault(),document.getElementById("messages").innerHTML="",!await async function(){e.DEBUGGEE={tabId:chrome.devtools.inspectedWindow.tabId};try{await chrome.debugger.attach(e.DEBUGGEE,"1.3")}catch(e){return t.add("Debuggerを開始できません。\n一度リロードし、デベロッパーツールを再表示してください。","error"),!1}e.ATTACHED=!0,await m("DOM.enable"),await m("CSS.enable"),await m("Page.enable"),await m("Overlay.enable");const{root:n}=await m("DOM.getDocument",{depth:-1});return e.ROOT_BODY=n.children[1].children[1],e.METRICS=await m("Page.getLayoutMetrics"),1536!=e.METRICS.contentSize.width&&390!=e.METRICS.contentSize.width?(t.add("ウィンドウサイズは390pxか1536pxにしてください。（検出サイズ："+e.METRICS.contentSize.width+"）","error"),!1):(1536==e.METRICS.contentSize.width&&(e.MODEL_DATA=MODEL_DATA_PC),390==e.METRICS.contentSize.width&&(e.MODEL_DATA=MODEL_DATA_SP),!0)}())return await chrome.debugger.detach(e.DEBUGGEE),!1;await async function(){e.PROCESSING=!0;const n=new Date;t.add("<<< 開始 "+n.toLocaleTimeString()+"."+n.getMilliseconds(),"info"),await c("$('main a:contains(6歳まで)').click();"),await a(500),await c("$(':contains(初めに受講者様と保護者様と面談を行い)').last().is(':visible')")||await c("$(':contains(オンラインの英会話教室は初めてで)').last().click();"),await c("$(':contains(パソコンやスマートフォンだけでなく、)').last().is(':visible')")||await c("$(':contains(外出先でも受講)').last().click();"),await c("$(':contains(授業料はコースによって異なります。)').last().is(':visible')")||await c("$(':contains(授業料はどのようになって)').last().click();"),await c("$(':contains(兄弟だけでなく家族割引プランや)').last().is(':visible')")||await c("$(':contains(兄弟だけでの受講を検討)').last().click();"),await a(1e3),await c("window.scrollTo(0,100000)"),await a(1e3),await c("$('.slick-list').parent().slick('slickPause')"),await a(1e3),await c("$('.slick-list').parent().slick('slickGoTo', 0)"),await c("window.scrollTo(0,0)"),await a(500)}(),1536==e.METRICS.contentSize.width?await async function(){t.emptyLine(),t.add("要素のプロパティチェック（背景色、境界線幅・色、境界角丸、高さ・幅）","title");const o='<p class="property-notice">【注意】<br>\n  ・差異があると報告されても鵜呑みにせずコードを確認してください<br>\n  ・border-radius系は上下がくっつく場合カンプより大きいと正常に見えます<br>\n  ・CTAの色はRGBとRGBA（透明度あり＝カンプ通り）の両方で比較しています<br>\n  ・高さや幅に小数点が含まれると、環境によって差異が出ます<br>\n  ・色はrgbやrgba関数として出力されますが、デベロッパーツールの仕様です</p>';t.add(o,"html"),t.emptyLine(),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE=o+"<br>";for(let o of ELEMENT_PROPERTIES_PC){t.add("◆"+o.name,"emphasis"),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE+="<strong>◆"+o.name+"</strong><br>";const{cssLayoutViewport:i}=await m("Page.getLayoutMetrics")??{cssLayoutViewport:null};i&&(i.pageY>o.y||i.pageY+i.clientHeight<=o.y)&&(await c("window.scrollTo(0,"+(o.y-i.clientHeight/2)+")"),await a(100));let r=await l(o.x,o.y);if(r)try{r=await E(r,o.properties);let i=!1;const{computedStyle:a}=await m("CSS.getComputedStyleForNode",{nodeId:r});for(let e of o.properties){const t=n(a,e.type).value;if(t!=e.value){if(e.orValue&&t==e.orValue)continue;u(e.type,t,e.value),i=!0}}i||(t.add("差異はありません。"),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE+="差異はありません<br>")}catch(e){console.log(e)}else console.log("要素が見つからない。"+o.name),t.add(o.name+"が見つかりません。"),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE+=o.name+"が見つかりません。<br>"}await c("window.scrollTo(0,0)"),await a(200)}():(t.emptyLine(),t.add("要素のプロパティチェック","title"),t.add("チェックはPC版だけです"),e.CHECK_ELEMENTS_PROPERTIES_MESSAGE="チェックはPC版だけです");const f=await async function(){e.RESULTS=[],e.RESULT_MESSAGES="";const a={},c=async t=>{const i={...t};if(i.nodeValue||i.childNodeCount||i.pseudoType){if(i.nodeValue&&"#comment"!=i.nodeName||i.pseudoType){let t;if(t=i.pseudoType?{...i}:o(i.parentId),t&&("SCRIPT"===t.nodeName||"NOSCRIPT"===t.nodeName||"STYLE"===t.nodeName||t.attributes&&t.attributes.find(e=>e.match(/^slick-slide-control/))))return;const{quads:r}=await m("DOM.getContentQuads",{nodeId:i.nodeId})??{quads:[]};if(!r.length)return;const s=function(e){if(1==e.length)return[e[0][0],e[0][1],e[0][4],e[0][5]];let t=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=0,i=0;for(const a of e)t=a[0]<t?a[0]:t,n=a[1]<n?a[1]:n,o=a[4]>o?a[4]:o,i=a[5]>i?a[5]:i;return[t,n,o,i]}(r),{fonts:c}=await m("CSS.getPlatformFontsForNode",{nodeId:i.nodeId})??{fonts:[]},{computedStyle:d}=await m("CSS.getComputedStyleForNode",{nodeId:i.parentId??i.nodeId})??{computedStyle:{}};i.pseudoType&&(i.nodeValue=n(d,"content").value);const l={color:n(d,"color").value,fontSize:n(d,"font-size").value,fontWeight:n(d,"font-weight").value,fontStyle:n(d,"font-style").value,fontFamily:n(d,"font-family").value,isWebFont:!0};if(c.length)for(let e of c)e.isCustomFont?a[e.familyName+" - Webフォント"]=e.isCustomFont:(a[e.familyName+" - ローカルフォント"]=e.isCustomFont,l.isWebFont=!1);const u=i.nodeValue.trim();e.RESULTS.push({nodeId:i.nodeId,nodeValue:u,box:s,property:l})}if(i.childNodeCount)for(let e=0;e<i.childNodeCount;e++)await c(i.children[e]);if(i.pseudoElements)for(let e=0;e<i.pseudoElements.length;e++)await c(i.pseudoElements[e])}};for(let t of e.ROOT_BODY.children)await c(t);t.add("適用フォント一覧","title");for(let e in a)e.match(/ローカルフォント/)?t.add(e,"error"):t.add(e);t.emptyLine(),t.add("slickのオプションチェック","title");let d=!1;await(async()=>new Promise(e=>{chrome.devtools.inspectedWindow.eval("$('.slick-list').parent().slick('slickGetOption', 'autoplay')",n=>{n?(t.add("autoplayにtrueが設定されています。"),d=!0):t.add("autoplayにtrueが設定されていません。","error"),e()})}))(),t.emptyLine(),t.add("テキスト要素比較","title"),t.add("どこかに差異があるテキスト要素を一覧します。"),t.add("各ボックスにホバーすると、その要素にフォーカスします。");for(const n of e.MODEL_DATA){let o=null;for(const a of e.RESULTS){const{nodeValue:c,box:d,property:l}=a;if(s(n.box,d)>0&&(c.match(n.nodeValue.trim())||n.nodeValue.match(c.trim()))){if(1==c.trim().length&&n.nodeValue.trim()!=c.trim())continue;o=a;const s=[];let u="";if(l.color!=n.property.color&&(s.push(2),u+="文字色が違います（コードは"+r(l.color)+"ですがカンプは"+r(n.property.color)+"）<br>"),l.fontSize!=n.property.fontSize&&(s.push(3),u+="文字の大きさが違います（コードは"+l.fontSize+"ですがカンプは"+n.property.fontSize+"）<br>"),l.fontWeight!=n.property.fontWeight&&(s.push(4),u+="文字の太さが違います（コードは"+l.fontWeight+"ですがカンプは"+n.property.fontWeight+"）<br>"),l.fontStyle!=n.property.fontStyle&&(s.push(5),u+="文字のスタイルが違います（コードは"+l.fontStyle+"ですがカンプは"+n.property.fontStyle+"）<br>"),i(l.fontFamily)?.toLowerCase()!=n.property.fontFamily.toLowerCase()&&(s.push(6),u+="フォントが違います（コードは"+i(l.fontFamily)+"ですがカンプは"+n.property.fontFamily+"）<br>"),l.isWebFont||(s.push(7),u+="Webフォントではありません<br>"),s.length>0){const o={format:"png",quality:100,fromSurface:!0,captureBeyondViewport:!0,clip:{x:d[0]-20,y:d[1]-20,width:d[2]-d[0]+40,height:d[3]-d[1]+40,scale:1}},p=await m("Page.captureScreenshot",o);p&&(u='<div><img src="data:image/png;base64,'+p.data+'"></div><p class="detail-text" contenteditable>'+u+"</p>"),e.RESULT_MESSAGES+='<div class="datum"><p class="detail-title">「'+n.nodeValue+"」</p>"+u+"</div>\n",t.table([`内容 (${a.nodeId})`,"color","font-size","font-weight","font-style","font-family","Webフォントか"],[n.nodeValue,r(n.property.color),n.property.fontSize,n.property.fontWeight,n.property.fontStyle,n.property.fontFamily,""],[c,r(l.color),l.fontSize,l.fontWeight,l.fontStyle,i(l.fontFamily),l.isWebFont?"はい":"いいえ"],s)}break}}o||(console.log("文字要素が見つからない。"+n.nodeValue),e.RESULT_MESSAGES+='<div class="datum"><p class="detail-title">「'+n.nodeValue+'」</p>\n<p class="detail-text" contenteditable>要素が取得できません。打ち間違いをチェックしてください。</p></div>\n',t.table(["内容","color","font-size","font-weight","font-style","font-family","Webフォントか"],[n.nodeValue,r(n.property.color),n.property.fontSize,n.property.fontWeight,n.property.fontStyle,n.property.fontFamily,""],["要素が取得できません。打ち間違いをチェックしてください。","","","","","",""],[]))}return d}();await async function(){t.add("position: relative と top/left/right/bottom が指定されている要素のチェック","title"),t.add("デバッグモードをONのまま結果の行にホバーするとどの要素か分かります。","emphasis");let o=0;e.POSITION_RELATIVE_CHECK="";const i=async(i,a,r=!1)=>{if(a&&a.attributes)for(let e=0;e<a.attributes.length;e+=2)if("class"===a.attributes[e]){const t=a.attributes[e+1].split(" ");if(t.includes("slick-track")||t.includes("slick-slide"))return;break}const{computedStyle:s}=await m("CSS.getComputedStyleForNode",{nodeId:i.nodeId})??{computedStyle:[]};if(!s||!s.length)return;const c=n(s,"position")?.value;if("relative"!==c)return;const{matchedCSSRules:d,inlineStyle:l}=await m("CSS.getMatchedStylesForNode",{nodeId:i.nodeId})??{matchedCSSRules:[],inlineStyle:null};let u=!1,p=!1;const E=["top","left","right","bottom"],f=e=>!!e&&e.some(e=>E.includes(e.name)&&""!==e.value.trim()&&"auto"!==e.value.trim()&&"initial"!==e.value.trim()&&"unset"!==e.value.trim());if(l&&f(l.cssProperties)&&(u=!0,!0),!u&&d)for(const{rule:e}of d)if(e&&e.style&&f(e.style.cssProperties)){u=!0;break}if(u){o++;const n=r?a:i;let s="";if(n.attributes)for(let e=0;e<n.attributes.length;e+=2)s+=` ${n.attributes[e]}="${n.attributes[e+1]}"`;const c=`&lt;${n.nodeName.toLowerCase()}${s}&gt;`;let d;d=r?`疑似要素: ${c}::${i.pseudoType} (nodeId: ${i.nodeId})`:`要素: ${c} (nodeId: ${i.nodeId})`,t.addHighlightNodeText(d,i.nodeId),e.POSITION_RELATIVE_CHECK+=d+"<br>\n"}},a=async e=>{if(e){if(1===e.nodeType&&await i(e,e,!1),e.pseudoElements)for(const t of e.pseudoElements)await i(t,e,!0);if(e.children)for(const t of e.children)await a(t)}};e.ROOT_BODY?(await a(e.ROOT_BODY),0===o&&(t.add("該当する要素は見つかりませんでした。"),e.POSITION_RELATIVE_CHECK+="該当する要素は見つかりませんでした。<br>\n")):t.add("DOMルート要素が見つかりません。デバッガを再起動してください。","error")}(),await a(100),t.makeToc();const S=await d("index.html"),h=await d("style.css"),y=await d("main.js");await async function(t,n,o,i){window.open("checker.html").addEventListener("load",async function(){this.document.querySelector("#css").value=n,this.document.querySelector("#js").value=o,this.document.querySelector("#slick").value=i?1:0,t?(this.document.querySelector("#html").value=t,this.document.querySelector(".perform").click()):this.document.querySelector(".perform").parentElement.style.display="block";let a="";document.getElementById("messages").querySelectorAll(".table").forEach(e=>{a+=e.outerHTML}),this.document.querySelector("#messages .tables").innerHTML=a,this.document.querySelector("#messages .details").innerHTML=e.RESULT_MESSAGES,this.document.querySelector("#messages .property_check").innerHTML=e.CHECK_ELEMENTS_PROPERTIES_MESSAGE,this.document.querySelector("#messages .position_relative_check").innerHTML=e.POSITION_RELATIVE_CHECK}),await a(100),window.scrollTo(0,0)}(S,h,y,f),function(){e.PROCESSING=!1,t.emptyLine();const n=new Date;t.add(">>> 終了 "+n.toLocaleTimeString()+"."+n.getMilliseconds(),"info"),t.emptyLine()}(),await a(100),window.scrollTo(0,0)}),chrome.debugger.onDetach.addListener(()=>{e.ATTACHED=!1}),(async()=>{await async function(){console.log("The version is checked.");try{const e=await fetch("https://raw.githubusercontent.com/ShigeUe/FinalExamChecker/refs/heads/main/manifest.json"),t=await e.json();return p(chrome.runtime.getManifest().version)<p(t.version)}catch(e){return!1}}()?t.add("新しいバージョンがあります。","error"):t.add("Version:"+chrome.runtime.getManifest().version)})(),chrome.devtools.inspectedWindow.reload()})();